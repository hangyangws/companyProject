!function(e,t,r){"use strict";var o=t("#orderWrap"),i=t("#tpStatusBtn"),n=t("#tpNoData").html(),a=t("#tpOrderList").html(),d={CUSTCONFIRMCASH:i.find(".js-CUSTCONFIRMCASH").html(),CUSTPAY:i.find(".js-CUSTPAY").html(),SHOPTAKE:i.find(".js-SHOPTAKE").html(),SHOPFINISH:i.find(".js-SHOPFINISH").html(),SHOPREFUSE:i.find(".js-SHOPREFUSE").html()},s=!0,c=10,p=1,l={init:function(){l.orderList()},orderList:function(){s&&(s=!0,e.oLoad(),t.ajax({url:"/order/list",type:"POST",dataType:"json",data:{pagenum:p,count:c,shopId:G.shopId,category:G.orderType},success:function(t){t.status?(l.renderOrderList(t.data),++p):1===p?o.html(n.replace("${msg}",t.isempty?"您暂时还没有订单哦":t.msg)):t.isempty||e.oConfrim(t.msg,!0),s=!0,e.cLoad()},error:function(){e.oConfrim("网络出错",!0),s=!0,e.cLoad()}}))},renderOrderList:function(e){for(var t,r=[],i=e.list,n=i.length;n--;)t=i[n],r.push(a.replace("${orderid}",t.orderid).replace("${ordersn}",t.ordersn).replace("${createtime}",t.createtime).replace("${expectdeliverytime}",t.expectdeliverytime).replace("${diningtypename}",t.diningtypename).replace("${freight}",t.freight).replace("${orderaddress}",t.orderaddress).replace("${paymentamount}",t.paymentamount).replace("${orderstatus}",d[t.orderstatus]));o.append(r.reverse().join(""))},orderOpt:function(r){var o;s&&(s=!1,e.oLoad(),o=r.closest(".order-item"),t.ajax({url:"/order/operate",type:"POST",dataType:"json",data:{orderId:o.data("id"),type:r.data("type")},success:function(t){t.status?(e.cConfrim(),l.slideUp(o,function(){location.reload(!0)})):e.reConfrim(t.msg,!0),e.cLoad(),s=!0},error:function(){e.cLoad(),e.reConfrim("网络出错"),setTimeout(function(){e.cConfrim()},800),s=!0}}))},slideUp:function(e,t){e.height(e.height()-10),setTimeout(function(){e.addClass("active"),setTimeout(function(){e.remove(),t&&t()},800)},100)},orderDetail:function(t){var r=t.data("id"),o=G.orderType;1==G.device?e.android.toOrderDetail(r,o):location.href="objc://orderDetail:"+r+"&"+o}};l.init(),o.on("tap",".js-order-opt",function(){var r=t(this),o={refuse:"确认拒绝此订单",take:"确认接受此订单",finish:"确认完成此订单"};e.oConfrim(o[r.data("type")],!1,function(){l.orderOpt(r)})}).on("tap",".order-detail",function(){}).on("scroll",function(){this.scrollHeight-this.offsetHeight===this.scrollTop&&l.orderList()})}(window||this,Zepto);
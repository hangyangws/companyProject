!function(t,o,e){"use strict";var n=o("#footer"),a=o("#shopWrap"),d=o("#tpNoData").html(),s=n.find(".js-price"),i=!0,c={statement:function(){n.is(".active")||(1==G.device?t.android.statement():location.href="objc://Statement")},del:function(e){var r=e.closest(".js-shop-item");i&&t.oConfrim("从购物车删除此店铺",!1,function(){"0"!==r.find(".js-car-num").html()?(i=!1,t.oLoad(),o.ajax({url:"/car/del",type:"POST",dataType:"json",data:{userId:G.userId,shopId:r.data("id")},success:function(t){t.status?("0.00"===t.totalAmount?(c.slideUp(r),a.html(d),n.remove()):(s.html(t.totalAmount),c.slideUp(r)),c.endOpt()):c.endOpt(t.msg)},error:function(){c.endOpt("网络出错")}})):(t.oLoad(),c.slideUp(r,function(){a.find(".js-shop-item").length||(a.html(d),n.remove()),c.endOpt()}))})},endOpt:function(o){t.cLoad(),t.cConfrim(),o&&t.oConfrim(o,!0),i=!0},slideUp:function(t,o){t.addClass("tsf-height"),t.height(t.height());var e=setTimeout(function(){t.css({height:0,margin:0,padding:0}),clearTimeout(e),e=setTimeout(function(){clearTimeout(e),t.remove(),o&&o()},1200)},100)},carOpt:function(e){i&&(i=!1,t.oLoad(),o.ajax({url:"/car/option",type:"POST",dataType:"json",data:{type:e.data("type"),foodid:e.closest(".js-food-item").data("id"),userid:G.userId,diningtypename:e.closest(".js-shop-item").data("dintypename")},success:function(t){t.status?(t.data.addCar=e.closest(".js-add-car"),c.carSuccess(t.data)):c.endOpt(t.msg)},error:function(){c.endOpt("网络出错")}}))},carSuccess:function(t){t.foodTotalCount?t.addCar.addClass("active"):t.addCar.removeClass("active"),t.addCar.find(".js-car-num").html(t.foodTotalCount),t.totalCount?n.removeClass("active"):n.addClass("active"),s.html(t.totalAmount),c.endOpt()},goIndex:function(){1==G.device?t.android.goIndex():location.href="objc://goIndex"},goFood:function(o){var e=o.closest(".js-food-item").data("id");1==G.device?t.android.goFood(e):location.href="objc://GoFood/"+e}};a.on("tap",".js-car-opt",function(){c.carOpt(o(this))}).on("tap",".js-del",function(){c.del(o(this))}).on("tap",".js-go-index",function(){c.goIndex()}).on("tap",".js-go-food",function(){c.goFood(o(this))}),n.on("tap",".js-statement",function(){c.statement()})}(window||this,Zepto);
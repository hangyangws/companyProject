!function(e,t,n){"use strict";var i,a=t("#main"),s=t("#mask"),o=t("#footer"),d=o.find(".js-amount"),r=s.find(".js-receipt"),c=s.find(".js-din-mode-mask"),f=a.find(".js-username"),m=a.find(".js-usertel"),u=a.find(".js-useraddr"),l=s.find(".js-username-edit"),h=s.find(".js-usertel-edit"),p=s.find(".js-useraddr-edit"),j=s.find(".js-m-dinbtn"),v=s.find(".js-m-sendfee"),g='<button class="js-din-mode-btn ts4 ${status}" data-name="${zhName}" data-freight="${freight}">${chName}</button>',C=!0,b={memberid:G.userId,recipientcontact:G.phone,shops:function(){for(var e=[],t=a.find(".js-shop-item"),n=t.length;n--;)e.push(t.eq(n).data("end"));return e}()},T={editAddr:function(){T.showMask(r,209)},editDinMode:function(e){i=e.closest(".js-shop-item");for(var t,n=i.data("dinmodelist"),a=n.length,s=[];a--;)t=n[a],s.push(g.replace("${status}",t["default"]?"active":"").replace("${zhName}",t.name).replace("${freight}",t.freight).replace("${chName}",t.zhname));j.html(s.join("")),v.html(e.find(".js-din-fee").html()),T.showMask(c,110)},changePay:function(e){e.siblings(".active").removeClass("active"),e.addClass("active"),i=e.closest(".js-shop-item"),T.reEndData(i.data("end").id,"paymentmethod",e.data("name"))},closeReceipt:function(){var e=t.trim(l.val()),n=t.trim(h.val()),i=t.trim(p.val());e&&(f.html(e).removeClass("fc-sub").addClass("fc-impor-one"),b.recipientname=e),n&&(m.html(n),b.recipientcontact=n),i&&(u.html(G.baseAddr+i),b.recipientaddress=G.baseAddr+i),T.closeMask()},selectDinMode:function(t){var n=t.html();t.siblings().removeClass("active"),t.addClass("active");var a=i.find(".js-din-fee").html();G.amount=e.NUM.sub(e.NUM.add(G.amount,t.data("freight")),a),d.html(G.amount),i.find(".js-din-name").html(n),i.find(".js-din-fee").html(t.data("freight"));for(var s=JSON.parse(i.attr("data-dinmodelist").replace("true","false")),o=s.length;o--;)if(s[o].zhname===n){s[o]["default"]=!0;break}i.attr("data-dinmodelist",JSON.stringify(s)),T.reEndData(i.data("end").id,"diningtypename",t.data("name"));var r=setTimeout(function(){clearTimeout(r),T.closeMask()},200)},showMask:function(e,t){s.removeClass("none");var n=setTimeout(function(){s.addClass("active"),clearTimeout(n),n=setTimeout(function(){clearTimeout(n),e.css({height:t,padding:"5px"})},100)},50)},closeMask:function(){s.children().css({height:0,padding:"0 5px"});var e=setTimeout(function(){s.removeClass("active"),clearTimeout(e),e=setTimeout(function(){s.addClass("none")},500)},300)},reEndData:function(e,t,n){for(var i=b.shops.length;i--;)if(b.shops[i].id===e){b.shops[i][t]=n;break}},del:function(n){C&&e.oConfrim("在订单中删除此店铺",!1,function(){C=!1,e.oLoad(),t.ajax({url:"/order/delete",type:"POST",dataType:"json",data:{shopId:n.closest(".js-shop-item").data("end").shopId},success:function(t){t.status?e.location.reload(!0):(e.cLoad(),e.oConfrim(t.msg,!0),C=!0)},error:function(){e.cLoad(),e.oConfrim("网络出错",!0),C=!0}})})},statement:function(){if(C){if(!b.recipientname)return void e.oConfrim("请输入收餐人",!0,function(){T.editAddr(),e.cConfrim()});if(!b.recipientcontact)return void e.oConfrim("请输入联系电话",!0,function(){T.editAddr(),e.cConfrim()});if(!b.recipientaddress)return void e.oConfrim("请输入详细地址",!0,function(){T.editAddr(),e.cConfrim()});for(var n,i=a.find(".js-shop-item"),s=i.length;s--;)n=i.eq(s),T.reEndData(n.data("end").id,"message",t.trim(n.find(".js-note").val()));C=!1,e.oLoad(),t.ajax({url:"/order/getid",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(b),success:function(t){if(e.cLoad(),t.status){var n=t.data.id;1==G.device?e.android.statement(n):location.href="objc://Statement/"+n}else e.oConfrim(t.msg,!0),C=!0},error:function(){e.cLoad(),e.oConfrim("网络出错",!0),C=!0}})}}};a.on("tap",".js-user-addr",function(){T.editAddr()}).on("tap",".js-din-mode",function(){T.editDinMode(t(this))}).on("tap",".js-pay",function(){T.changePay(t(this))}).on("tap",".js-del",function(){T.del(t(this))}),o.on("tap",".js-statement",function(){T.statement()}),s.on("tap",".js-close-receipt",function(){T.closeReceipt()}).on("tap",".js-close-din",function(){T.closeMask()}).on("tap",".js-din-mode-btn",function(){T.selectDinMode(t(this))})}(window||this,Zepto);
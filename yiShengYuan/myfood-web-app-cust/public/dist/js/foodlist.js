!function(o,e,a){"use strict";var t=e(o),s=e("#foodSelect"),i=s.find(".js-item-select"),n=s.find(".js-type-select"),d=e("#main"),c=s.find(".js-type-select"),p=s.find(".js-item-select"),r=$body[0],l=e("#tpNoData").html(),g=e("#tpShopList").html(),h=e("#tpError").html(),f="background: url(${img}) 50% 50% / cover no-repeat;",u=10,m=1,v=!0,y={init:function(){var o={s_applongitude:G.lng,s_applatitude:G.lat,s_categoryid:i.find("li:first-child").addClass("active").data("id"),pagenum:1,count:u};G.search&&(o.search=G.search),y.loadShop(o)},typeOpen:function(){i.toggleClass("active"),n.toggleClass("active")},typeSelect:function(o){var e={s_applongitude:G.lng,s_applatitude:G.lat,s_categoryid:o.data("id"),pagenum:1,count:u};G.search&&(e.search=G.search),y.loadShop(e,function(){c.removeClass("active")[0].firstChild.nodeValue=o.html(),p.removeClass("active").find(".active").removeClass("active"),o.addClass("active")})},loadShop:function(a,t){if(!a)var a={s_applongitude:G.lng,s_applatitude:G.lat,s_categoryid:G.s_categoryid,pagenum:m,count:u};var s,i,n=n=[];v&&(v=!1,o.oLoad(),G.s_categoryid=a.s_categoryid,e.ajax({url:"/food/list",type:"POST",dataType:"json",data:a,success:function(e){if(e.status){for(s=e.foodList.length;s--;)i=e.foodList[s],i.shopdistance=i.shopdistance+"",n.push(g.replace("${foodId}",i.foodid).replace("${shopid}",i.shopid).replace("${shopname}",i.shopname).replace("${styleFoodImg}",f.replace("${img}",i.foodimagepath)).replace("${styleCookImg}",f.replace("${img}",i.shopportraitpath)).replace("${shopStatus}",i.shopisopen).replace("${gray}","休息中"===i.shopisopen?"gray":"").replace("${foodName}",i.foodname).replace("${shopAddr}",i.shopaddress).replace(/\${distance}/g,i.shopdistance.slice(0,i.shopdistance.indexOf("."))).replace("${price}",i.foodprice).replace("${sales}",i.foodsales||0));n=n.reverse().join(""),1==a.pagenum?d.html('<ul class="food-wrap fs12">'+n+"</ul>"):d.find(".food-wrap").append(n),m=a.pagenum+1,v=!0,o.cLoad()}else e.isempty?y.errorMsg(a.pagenum,1):y.errorMsg(a.pagenum,2,e.msg)},error:function(){y.errorMsg(a.pagenum,2,"网络出错")}})),t&&t()},errorMsg:function(e,a,t){v=!0,o.cLoad(),1==e?d.html(1==a?l:h.replace("${msg}",t)):2==a&&o.oConfrim(t,!0)},changeAddr:function(){1==G.device?o.android.changeAddr():location.href="objc://ChangeAddr"},reLoad:function(){var o={s_applongitude:G.lng,s_applatitude:G.lat,s_categoryid:G.s_categoryid,pagenum:1,count:u};G.search&&(o.search=G.search),y.loadShop(o)},goShop:function(e){var a=e.data("shopid"),t=e.data("shopname"),s=e.data("distancce");1==G.device?o.android.goShop(a,s,t):location.href="objc://goShop:/"+a+"/"+s+"/"+t},goFood:function(e){1==G.device?o.android.goFood(e):location.href="objc://goFood:/"+e}};y.init(),s.on("tap",".js-type-select",function(){y.typeOpen()}).on("tap","li",function(){y.typeSelect(e(this))}),d.on("tap",".js-change-addr",function(){y.changeAddr()}).on("tap",".js-reload",function(){y.reLoad()}).on("tap",".js-go-shop",function(){y.goShop(e(this).closest(".food-item"))}).on("tap",".js-go-food",function(){y.goFood(e(this).closest(".food-item").data("foodid"))}),t.on("scroll",function(){r.scrollHeight-r.clientHeight+30===r.scrollTop&&y.loadShop()})}(window||this,Zepto);
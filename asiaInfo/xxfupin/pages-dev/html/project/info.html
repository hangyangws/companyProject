#parse("./common.html")
<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="UTF-8" />
    <title>用户登录</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1.0, maximum-scale=1.0,user-scalable=no" />
    <meta name="screen-orientation" content="portrait" />
    <meta name="full-screen" content="yes" />
    <meta name="browsermode" content="application" />
    <meta name="x5-orientation" content="portrait" />
    <meta name="x5-fullscreen" content="true" />
    <meta name="x5-page-mode" content="app" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="shortcut icon" href="$!ctx/pages-dev/static/img/icon/ico.png" />
    <!-- coolie -->
    <!-- /coolie -->
</head>

<body>
    <main class="fcf h1 ofh" id="loginPassword">
        <!-- logo -->
        <figure id="logo" class="logo">
            <h1>项目详情</h1>
        </figure>
        <section id="content" class="content pr">
        <a href="$ctx/project/$!project.projectId/edit">修改</a>
        <a href="$ctx/project/$!project.projectId/del">删除</a>
        <a href="$ctx/project/family/$!project.projectId/search">添加受助人</a>
        <p>项目名称：$!project.projectName
        <p>项目简介：$!project.projectDesc
        <p>实施时间：$!{project.startTime}~$!{project.endTime}
        <p>实施地点：$!project.projectProvinceLabel.$!project.projectCityLabel.$!project.projectDistrictLabel
        <p>年龄：$!{project.startAge}-$!{project.endAge}岁
        <p>性别：$!project.sexLimitLabel
        <p>联系人：$!project.contact
        <p>联系电话：$!project.contactPhone
        <p>联系邮箱：$!project.contactEmail
        <p>项目预算：$!project.planAmount
        <p>帮助人数：$!project.planCount
        <p>备注：$!project.remark
        </section>
	    <ul id="list"></ul>
	    <ul id="page"></ul>
    </main>
    <!-- coolie -->
    <script src="$!ctx/pages-dev/static/js/plugin/zepto.js"></script>
    <script src="$!ctx/pages-dev/static/js/plugin/touch.js"></script>
    <script>
    $('#btnSign').click(function() {
    	$.post('$!ctx/commonweal/login', {
    		"mobile": $('#user_mobile').val(),
    		"vcode": $('#vcode').val(),
    		"type": $('#type').val(),
    	}, function(json) {
    		if(json && json.code === 0) {
    			alert('成功');
    			window.location.href = '$ctx/commonweal';
    		} else {
    			alert(json.msg);
    		}
    	});
    });
    $('#btnGetVcode').click(function() {
    	var data = {'mobile':$('#user_mobile').val()};
    	$.get('$ctx/sms/send', data, function(json) {
    		if(!json || json.code) {
    			alert(json.msg);
    			return;
    		}

    		$.get('$ctx/sms', data, function(json) {
    			if(json && json.code === 0) {
    				$('#vcode').val(json.data);
    			} else {
    				alert(json.msg);
    			}
    		});
    	});
    });

    $(function() {
    	go(1);
    });
    function go(pageNo) {
    	var data = {
    			"projectId": "$!project.projectId",
    			"include": true
    	}
    	// 测试期间，每页三条
    	$.post('$ctx/project/family/$!project.projectId/search/' + pageNo + '/2', data, function(json) {
    		if(json && json.code === 0) {
    			var page = json.data;
    			// 计算页数
    			var pageCount = Math.ceil(page.count * 1.0 / page.size);
    			// 生成翻页按钮
    			$('#page').html('页码：');
    			for(var i = 1; i <= pageCount; i++) {
    				$('#page').append('<li><a href="javascript:go(' + i + ');">' + i + '</a></li>');
    			}
    			// 显示数据
    			var list = page.data;
    			$('#list').html('');
    			for(var i = 0; i < list.length; i++) {
    				var data = list[i];
    				var s = '<li>'
    					+ '姓名:' + data.name + '<br/>'
						+ '性别:' + data.sexLabel + '<br/>'
						+ '年龄:' + data.age + '<br/>'
						+ '地址:' + data.addrProvinceLabel + data.addrCityLabel + data.addrDistrictLabel + data.address + '<br/>';
    				var tags = data.tags;
    				for(var j in tags) {
    					s += '<i>' + tags[j] + '</i> ';
    				}
    				s += '<p>';
    				s += '<a href="$ctx/project/family/del/' + data.bindId + '">取消添加</a> ';
    				s += '<a href="$ctx/project/family/$!project.projectId/' + data.familyId + '">查看详情</a></li>';

    				$('#list').append(s);
    			}
    		} else {
    			alert(json.msg);
    		}
    	});
    }
    </script>
    <!-- /coolie -->
</body>

</html>

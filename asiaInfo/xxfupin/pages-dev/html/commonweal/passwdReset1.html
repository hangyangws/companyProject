#parse("./common.html")
<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="UTF-8" />
    <title>重置密码-第一步</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1.0, maximum-scale=1.0,user-scalable=no" />
    <meta name="screen-orientation" content="portrait" />
    <meta name="full-screen" content="yes" />
    <meta name="browsermode" content="application" />
    <meta name="x5-orientation" content="portrait" />
    <meta name="x5-fullscreen" content="true" />
    <meta name="x5-page-mode" content="app" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="shortcut icon" href="$!ctx/pages-dev/static/img/icon/ico.png" />
    <!-- coolie -->
    <!-- /coolie -->
</head>

<body>
    <main class="fcf h1 ofh" id="loginPassword">
        <!-- logo -->
        <figure id="logo" class="logo">
            <h1>重置密码-第一步</h1>
        </figure>
        <section id="content" class="content pr">
            <p>手机号
                <input id="user_mobile">
                <p>短信验证码
                    <input id="vcode">
                    <p>
                        <button id="btnSign">下一步</button>
                        <p>
                            <button id="btnGetVcode">获取验证码</button>
        </section>
    </main>
    <!-- coolie -->
    <script src="$!ctx/pages-dev/static/js/plugin/zepto.js"></script>
    <script src="$!ctx/pages-dev/static/js/plugin/touch.js"></script>
    <script>
    $('#btnSign').click(function() {
        $.post('$!ctx/commonweal/password/reset/1', {
            "mobile": $('#user_mobile').val(),
            "vcode": $('#vcode').val()
        }, function(json) {
            if (json && json.code === 0) {
                window.location.href = '$ctx/commonweal/password/reset/' + json.data;
            } else {
                alert(json.msg);
            }
        });
    });
    $('#btnGetVcode').click(function() {
        var data = {
            'mobile': $('#user_mobile').val()
        };
        $.get('$ctx/sms/send', data, function(json) {
            if (!json || json.code) {
                alert(json.msg);
                return;
            }

            $.get('$ctx/sms', data, function(json) {
                if (json && json.code === 0) {
                    $('#vcode').val(json.data);
                } else {
                    alert(json.msg);
                }
            });
        });
    });
    </script>
    <!-- /coolie -->
</body>

</html>

#parse("/common.html")
<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="UTF-8" />
    <title>扶贫动态首页</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1.0, maximum-scale=1.0,user-scalable=no" />
    <meta name="robots" content="index" />
    <meta name="screen-orientation" content="portrait" />
    <meta name="full-screen" content="yes" />
    <meta name="browsermode" content="application" />
    <meta name="x5-orientation" content="portrait" />
    <meta name="x5-fullscreen" content="true" />
    <meta name="x5-page-mode" content="app" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="shortcut icon" href="$ctx/pages-dev/static/img/icon/icon.png" />
    <!-- coolie -->
    <link rel="stylesheet" href="$ctx/pages-dev/static/css/base.css" />
    <!-- /coolie -->
</head>

<body class="bg-gray">
    <main class="main-wrap h1 ofh">
    <style>
    h2{background:#ff0;margin:10px 0;}
    .list li{margin-bottom:10px;}
    .page{height:20px;line-height:20px;}
    .page li{display:inline-block;border:1px solid #49f;width:20px;text-align:center;color:#49f;}
    </style>
    
    <div id="news">
        <h2>新闻动态</h2>
	    <ul class="list"></ul>
	    <ul class="page"></ul>
    </div>
    
    <div id="notice">
        <h2>公示公告</h2>
	    <ul class="list"></ul>
	    <ul class="page"></ul>
    </div>
    
    <div id="pubinfo">
        <h2>信息公布</h2>
        <ul class="list"></ul>
        <ul class="page"></ul>
    </div>
    
    </main>
    <!-- coolie -->
    <script src="$ctx/pages-dev/static/js/plugin/fastclick.js"></script>
    <script src="$ctx/pages-dev/static/js/plugin/zepto.js"></script>
    <script src="$ctx/pages-dev/static/js/plugin/touch.js"></script>
    <script>
    $(function() {
        go('news', 1);
        go('notice', 1);
        go('pubinfo', 1);
    });
    
    // 全局查询：$uctx/record
    // 查询“我的”：$uctx/record/my
    
    function go(id, pageNo) {
        var data = {};
        // 测试期间，每页三条
        $.post('$uctx/dynamic/' + id + '/' + pageNo + '/1', data, function(json) {
            if(json && json.code === 0) {
                var page = json.data;
                // 计算页数
                var pageCount = Math.ceil(page.count * 1.0 / page.size);
                // 生成翻页按钮
                $('#' + id + '>.page').html('');
                for(var i = 1; i <= pageCount; i++) {
                    $('#' + id + '>.page').append('<li><a href="javascript:go(\'' + id + '\',' + i + ');">' + i + '</a></li>');
                }
                // 显示数据
                var list = page.data;
                $('#' + id + '>.list').html('');
                for(var i = 0; i < list.length; i++) {
                    var data = list[i];
                    var s = '<li>'
                        + '标题:<a href="$uctx/dynamic/' + id + '/' + data.newsId + '">' + data.summary + '</a><br/>'
                        + '内容:' + data.content + '<br/>'
                        + '赞(' + data.likeCount + ')<br/>'
                        + '评论(' + data.commonCount + ')<br/>';
                    s += '<p>';
                    //s += '<a href="$uctx/dynamic/' + id + '/' + data.newsId + '/edit">编辑</a> ';
                    
                    /* s += '<ul>赞：';
                    var likes = data.likes;
                    for(var j in likes) {
                        s += '<li>' + likes[j] + '</li> ';
                    }
                    s += '<li><a href="javascript:taplike(' + data.newsId + ')">点赞</a></li>';
                    s += '</ul>'; */
                    
                    /* s += '<ul>评论：';
                    s += '<input id="reply" type="hidden">';
                    var comments = data.comments;
                    for(var j in comments) {
                        var c = comments[j];
                        s += '<li><a href="javascript:reply(' + c.creator + ')">' + c.userName + '</a>';
                        if(c.replyName) {
                            s += ' 回复 <a href="javascript:reply(' + c.replyUser + ')">' + c.replyName + '</a>';
                        }
                        s += ': ' + c.comment + '</li> ';
                    }
                    s += '<li>'
                        + '<input >'
                        + '<button onclick="comment(' + data.newsId + ',this)">评论</button>';
                    
                    s += '</li>';
                    s += '</ul>'; */
                    
                    s += '<ul>图片：';
                    var attaches = data.attaches;
                    for(var j in attaches) {
                        var a = attaches[j];
                        s += '<i><img src="$ctx/file/' + a.fileid + '.thumb" alt="$ctx/file/' + a.fileid + '"/></i> ';
                    }
                    s += '</ul>';
                    
                    $('#' + id + '>.list').append(s);
                }
            } else {
                alert(json.msg);
            }
        });
    }
    
    /* function taplike(id) {
        $.post('$uctx/record/' + id + '/taplike', function(json) {
            if(json.code === 0) {
                alert(json.data)
            } else {
                alert(json.msg);
            }
        });
    }
    
    function reply(id) {
        $('#reply').val(id);
    }
    
    function comment(id, o) {
        var input = $(o).prev();
        $.post('$uctx/record/' + id + '/comment', {
            "replyUser": $('#reply').val(),
            "comment": input.val()
        }, function(json) {
            if(json.code === 0) {
                alert(json.data);
            } else {
                alert(json.msg);
            }
            $('#reply').val("");
        });
    }; */
    </script>
    <!-- /coolie -->
</body>

#parse("./common.html")
<!-- 本页面全局变量$type ==（'modify' || 'add' || 'view'） -->
<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="UTF-8" />
    <title>#if($type == 'modify')修改#elseif($type == 'add')添加#else查看#end帮扶记事</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1.0, maximum-scale=1.0,user-scalable=no" />
    <meta name="robots" content="index" />
    <meta name="screen-orientation" content="portrait" />
    <meta name="full-screen" content="yes" />
    <meta name="browsermode" content="application" />
    <meta name="x5-orientation" content="portrait" />
    <meta name="x5-fullscreen" content="true" />
    <meta name="x5-page-mode" content="app" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="shortcut icon" href="$ctx/pages-dev/static/img/icon/icon.png" />
    <!-- coolie -->
    <link rel="stylesheet" href="$ctx/pages-dev/static/css/base.css" />
    <link rel="stylesheet" href="$ctx/pages-dev/static/css/public.css" />
    <link rel="stylesheet" href="$ctx/pages-dev/static/css/plugin/layer.css" />
    <!-- /coolie -->
    <!-- coolie -->
    <link rel="stylesheet" href="$ctx/pages-dev/static/poverty/css/new-note.css" />
    <!-- /coolie -->
</head>

<body id="body" class="bg-gray">
    <!-- 一共有5种模式，修改modify(平困户列表修改、普通修改)，新增add（平困户列表新增、普通新增），查看view -->
    <!-- 用：($fromFamily)也可以判断是否来自贫困户列表 -->
    <!-- 添加类：no-footer 不显示页脚(保险起见，使用模板引擎不显示页脚) -->
    <!-- 添加类：no-edit-user 不显示用户列表右边的删除按钮 -->
    <main class="main-wrap h1 ofh #if($type == 'view')no-footer no-edit-user#end #if($fromFamily)no-edit-user#end">
        <header id="header" class="header gradient-bg pr">
            #if($type == 'modify')
            <button class="j-del-note del-btn middle bc db">
                <i class="i i-4-18"></i>
            </button>
            #end
        </header>
        <section id="content" class="content pa bb">
            <div class="con-wrap">
                <input type="hidden" name="attachUploadKey" value="$!relationId" />
                <!-- 基本内容 -->
                <ul>
                    #if($type != 'add')
                    <li class="e-time gradient-bg"><i class="i i-4-9"></i><span class="j-time" data-time="$info.createTime"></span></li>
                    #end
                    <li class="each-list e-name">
                        <i class="i i-4-10"></i>
                        <dl class="each-con">
                            <dt>标题</dt>
                            <dd class="bb tar">
                                #if($type == 'view')
                                $!info.summary
                                #else
                                <input class="ipt-txt" type="text" value="$!info.summary" name="summary" maxlength="10" placeholder="请输入标题" data-vname="标题" data-vtype="require" />
                                #end
                            </dd>
                        </dl>
                    </li>
                    #if($type != 'view' || $!family.name)
                    <li class="each-list">
                        <i class="i i-1-17"></i>
                        <dl class="each-con">
                            <dt class="ofh">
                                走访贫困户
                                #if($type != 'view' && !$fromFamily)
                                <span class="j-pop-search select-user fr tar"><i class="i i-3-15"></i></span>
                                #end
                            </dt>
                            <dd>
                                <input class="j-relation" type="hidden" name="relationId" value="$!family.familyId" data-vname="走访贫困户" data-vtype="require" />
                                <ul class="j-user-list user-list">
                                    #if(($type != 'add' || $fromFamily) && $!family.name)
                                    <li>
                                        <span>$!family.name</span><i class="j-del-user i i-4-17"></i>
                                    </li>
                                    #end
                                </ul>
                                #if($type != 'view' && !$fromFamily)
                                <p class="u-tip">最多可添加1位贫困户</p>
                                #end
                            </dd>
                        </dl>
                    </li>
                    #end
                    <li class="each-list">
                        <i class="i i-4-15"></i>
                        <dl class="each-con">
                            <dt>内容</dt>
                            <dd>
                                #if($type == 'view')
                                <div class="e-con e-con-view">$!info.content</div>
                                #else
                                <textarea class="j-msg e-con" name="content" placeholder="请输入内容" maxlength="100" data-vname="帮扶记事内容" data-vtype="require">$!info.content</textarea>
                                #end
                            </dd>
                        </dl>
                    </li>
                    #if($type == 'view')
                    #if($!info.attaches.size() != 0)
                    <li class="each-list">
                        <i class="i i-4-16"></i>
                        <dl class="each-con">
                            <dt>图片</dt>
                            <dd class="e-img">
                                #foreach($attach in $!info.attaches)
                                <div class="j-lazy-img j-note-img" data-id="${attach.fileid}" data-thumbnail="$ctx/file/${attach.fileid}.thumb.jpg" data-original="$ctx/file/${attach.fileid}.jpg"><span></span></div>
                                #end
                            </dd>
                        </dl>
                    </li>
                    #end
                    #else
                    <li class="each-list">
                        <i class="i i-4-16"></i>
                        <dl class="each-con">
                            <dt>图片</dt>
                            <dd class="j-img-wrap e-img">
                                #if($!info.attaches)
                                #foreach($attach in $!info.attaches)
                                <div class="j-lazy-img j-note-img" data-id="${attach.fileid}" data-thumbnail="$ctx/file/${attach.fileid}.thumb.jpg" data-original="$ctx/file/${attach.fileid}.jpg"><span></span></div>
                                #end
                                #end
                                <!-- 隐藏按钮添加类：img-hidden -->
                                <div class="j-add-img add-img">
                                    <span class="pr">
                                        <input class="j-img-file img-file" type="file" name="file" />
                                        <i class="i i-3-2 middle"></i>
                                    </span>
                                </div>
                                #if($type != 'view')
                                <p class="u-tip">最多可添加9张图片</p>
                                #end
                            </dd>
                        </dl>
                    </li>
                    #end
                </ul>
                <!-- 评论列表 -->
                #if($type != 'add' && $!info.comments.size() != 0)
                <h5 class="com-tit fc9">全部评论（共$!info.comments.size()条）</h5>
                <ul class="j-com-wrap com-con fc3">
                    #foreach($comment in $!info.comments)
                    <li class="j-each-com" data-id="$!comment.id" data-userid="$!comment.creator">
                        <div class="j-coment">
                            <header>
                                <span class="j-user">$!comment.userName</span>
                                <span class="com-time">$!date.formatByTimeline($comment.createTime)</span>
                            </header>
                            <p>#if($!comment.replyName)<span data-id="$comment.replyUser">@$!comment.replyName：</span>#end$comment.comment</p>
                        </div>
                        #if($!USER_SESSION.userid == $comment.creator)
                        <i class="j-del-com i i-4-17"></i>
                        #end
                    </li>
                    #end
                </ul>
                #end
            </div>
        </section>
        #if($type != 'view')
        <footer id="footer" class="footer w1 bb pa l0 b0">
            <button class="j-sub btn-def btn-sub w1"><i class="i i-1-3"></i><span>&emsp;保存</span></button>
        </footer>
        #end
        <!-- 评论弹窗 -->
        <footer id="replay" class="reply-wrap pa w1 b0 l0 ofh bcf none">
            <div class="replay-con pr">
                <div class="replay-ipt-wrap">
                    <textarea class="j-re-ipt replay-ipt fc3 w1 h1" maxlength="100"></textarea>
                </div>
                <!-- 添加类：jc-re-sure 触发可提交 -->
                <button class="j-re-sure reply-btn pa r0 b0 bb">发送</button>
            </div>
        </footer>
        #if($type != 'view' && !$fromFamily)
        <!-- 搜索联系人弹窗 -->
        <!-- 移除类：none、添加类：se-man-active，可见 -->
        <div id="searchMan" class="se-man-pop none">
            <div class="se-man-wrap">
                <header class="se-header bcf pr">
                    <label class="se-ipt-wrap bb db">
                        <i class="i i-4-5 pa t0 b0"></i>
                        <div class="se-ipt-con">
                            <input class="j-search-ipt w1 fc3" type="text" placeholder="请输入贫困户名字进行搜索" />
                        </div>
                    </label>
                    <button class="j-se-btn se-btn tac bct pa r0 t0 b0">搜索</button>
                </header>
                <ul class="j-search-con se-man-con fc3">
                    <!-- 搜索联系人动态展示区域 -->
                    <!-- 添加类：item-checked，激活选中 -->
                </ul>
                <footer class="se-man-footer bb">
                    <button class="j-se-sure w1 btn-def"><i class="i i-1-3"></i><span>&emsp;确认</span></button>
                </footer>
            </div>
        </div>
        #end
    </main>
    <!-- 图片预览 -->
    <div id="imgMask" class="mask img-mask pf w1 h1 t0 l0 none">
        <div class="img-view pa">
            <span class="j-close-img close-img pa z2"><i class="middle i i-6-2"></i></span>
            <figure class="j-img-view img-show z1"></figure>
        </div>
        #if($type != 'view')
        <div class="j-del-img del-img-btn" data-role="button"><i class="i i-6-3"></i><span>&emsp;删除</span></div>
        #end
    </div>
    <!-- 模板引擎 -->
    <!-- 搜索的平困户 -->
    <template class="tp" data-name="searchuser">
        <li class="j-se-item se-item" data-id="{{id}}">
            <i class="i i-1-17 pa t0 b0"></i>
            <p class="j-se-name se-item-name">{{name}}</p>
            <div class="se-radio pa r0 t0 h1 bb">
                <i class="i i-5-8"></i>
            </div>
        </li>
    </template>
    <!-- 搜索平困户结果为空 -->
    <template class="tp" data-name="searchnodata">
        <li class="fc9 tac">没有搜索结果</li>
    </template>
    <!-- 选择的贫困户 -->
    <template class="tp" data-name="selecteduser">
        <li>
            <span>{{name}}</span><i class="j-del-user i i-4-17"></i>
        </li>
    </template>
    <!-- 图片展示 -->
    <template class="tp" data-name="image">
        <div class="j-note-img" data-id="{{id}}" data-original="$ctx/file/{{id}}.jpg"><span style="background: url({{img}}) no-repeat 50% 50% / cover #000"></span></div>
    </template>
    <!-- 评论 -->
    <template class="tp" data-name="comment">
        <li class="j-each-com" data-id="{{comId}}" data-userid="{{userId}}">
            <div class="j-coment">
                <header>
                    <span class="j-user">{{userName}}</span>
                    <span class="com-time">{{time}}</span>
                </header>
                <p><span data-id="{{toId}}">{{toName}}</span>{{txt}}</p>
            </div>
            <i class="j-del-com i i-4-17"></i>
        </li>
    </template>
    <!-- coolie -->
    <script src="$ctx/pages-dev/static/js/plugin/fastclick.js"></script>
    <script src="$ctx/pages-dev/static/js/plugin/zepto.js"></script>
    <script src="$ctx/pages-dev/static/js/plugin/touch.js"></script>
    <script src="$ctx/pages-dev/static/js/plugin/layer.js"></script>
    <script src="$ctx/pages-dev/static/js/public.js"></script>
    <script src="$ctx/pages-dev/static/js/verify.js"></script>
    <!-- /coolie -->
    <script>
    (window || this).G = {
        creator: '$!USER_SESSION.userid',
        userName: '$!USER_SESSION.name',
        sub_url: '$!uctx/record/' + ('$!info.newsId' || 'add'),
        user_url: '$uctx/record' + ('$!fromFamily' ? '?family=$!fromFamily' : '') + ('$type' != 'view' ? '#tab1' : ''),
        com_del_url: '$!uctx/record/$!info.newsId/comment/{{commentId}}/delete',
        note_del_url: '$!uctx/record/$!info.newsId/delete',
        del_img_url: '$ctx/file/{{id}}/delete',
        search_url: '$uctx/family/{{page}}/{{size}}',
        file_url: '$ctx/file/upload',
        relationId: '$!relationId',
        re_url: '$uctx/record/$!info.newsId/comment',
        type: '$type',
        biztype: 'NEWS'
    };
    </script>
    <!-- coolie -->
    <script src="$ctx/pages-dev/static/poverty/js/new-note.js"></script>
    <!-- /coolie -->
</body>
